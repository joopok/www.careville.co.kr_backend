<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/apage/default_layout}">
<head>
<title>대시보드</title>
<!-- All styles now in careville-admin.css -->
</head>
<body>
<div layout:fragment="content">

	<!-- Page Header -->
	<div class="cv-page-header">
		<div class="cv-page-header-left">
			<h1 class="cv-page-title">대시보드</h1>
			<p class="cv-page-desc">안녕하세요! 관리자 현황입니다.</p>
		</div>
	</div>

	<!-- Stats Grid -->
	<div class="cv-stats">
		<div class="cv-stat-card slide-up">
			<div class="cv-stat-icon purple">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
				</svg>
			</div>
			<div class="cv-stat-label">신규 상담</div>
			<div class="cv-stat-value" id="statNewCnslt">-</div>
		</div>

		<div class="cv-stat-card slide-up">
			<div class="cv-stat-icon blue">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
					<circle cx="8.5" cy="8.5" r="1.5"></circle>
					<polyline points="21 15 16 10 5 21"></polyline>
				</svg>
			</div>
			<div class="cv-stat-label">시공 사례</div>
			<div class="cv-stat-value" id="statCase">-</div>
		</div>

		<div class="cv-stat-card slide-up">
			<div class="cv-stat-icon amber">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
				</svg>
			</div>
			<div class="cv-stat-label">고객 리뷰</div>
			<div class="cv-stat-value" id="statReview">-</div>
		</div>

		<div class="cv-stat-card slide-up">
			<div class="cv-stat-icon green">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
				</svg>
			</div>
			<div class="cv-stat-label">상품</div>
			<div class="cv-stat-value" id="statProduct">-</div>
		</div>
	</div>

	<!-- Content Grid -->
	<div class="content-grid">
		<!-- Recent Activity -->
		<div class="cv-card slide-up" style="animation-delay: 0.25s;">
			<div class="cv-card-header">
				<h3 class="cv-card-title">최근 활동</h3>
				<a th:href="@{/apage/cnslt010.do}" class="cv-btn cv-btn-sm cv-btn-ghost">전체보기</a>
			</div>
			<div class="cv-card-body">
				<ul class="activity-list" id="activityList">
					<li class="activity-item">
						<div class="activity-content">
							<div class="activity-desc" style="color: var(--cv-silver-400);">로딩 중...</div>
						</div>
					</li>
				</ul>
			</div>
		</div>

		<!-- Quick Links -->
		<div class="cv-card slide-up" style="animation-delay: 0.3s;">
			<div class="cv-card-header">
				<h3 class="cv-card-title">바로가기</h3>
			</div>
			<div class="cv-card-body">
				<div class="quick-links">
					<a th:href="@{/apage/cnslt010.do}" class="quick-link">
						<div class="quick-link-icon">
							<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
							</svg>
						</div>
						<div class="quick-link-text">
							<div class="quick-link-title">온라인 상담</div>
							<div class="quick-link-desc">상담 요청 관리</div>
						</div>
						<svg class="quick-link-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="9 18 15 12 9 6"></polyline>
						</svg>
					</a>
					<a th:href="@{/apage/case010.do}" class="quick-link">
						<div class="quick-link-icon">
							<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
								<circle cx="8.5" cy="8.5" r="1.5"></circle>
								<polyline points="21 15 16 10 5 21"></polyline>
							</svg>
						</div>
						<div class="quick-link-text">
							<div class="quick-link-title">시공 사례</div>
							<div class="quick-link-desc">포트폴리오 관리</div>
						</div>
						<svg class="quick-link-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="9 18 15 12 9 6"></polyline>
						</svg>
					</a>
					<a th:href="@{/apage/review010.do}" class="quick-link">
						<div class="quick-link-icon">
							<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
							</svg>
						</div>
						<div class="quick-link-text">
							<div class="quick-link-title">고객 리뷰</div>
							<div class="quick-link-desc">고객 피드백 관리</div>
						</div>
						<svg class="quick-link-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="9 18 15 12 9 6"></polyline>
						</svg>
					</a>
					<a th:href="@{/apage/product010.do}" class="quick-link">
						<div class="quick-link-icon">
							<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
							</svg>
						</div>
						<div class="quick-link-text">
							<div class="quick-link-title">상품 관리</div>
							<div class="quick-link-desc">서비스 상품 관리</div>
						</div>
						<svg class="quick-link-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="9 18 15 12 9 6"></polyline>
						</svg>
					</a>
				</div>
			</div>
		</div>
	</div>

<script th:inline="javascript">
$(document).ready(function() {
	loadDashboardData();
});

function loadDashboardData() {
	$.ajax({
		url: '/apage/dashboardData.do',
		type: 'POST',
		dataType: 'json',
		success: function(data) {
			if (data.result === 'SUCCESS') {
				// 통계 데이터 렌더링
				renderStats(data.stats);
				// 최근 활동 렌더링
				renderActivities(data.recentActivities);
			} else {
				console.error('Dashboard data load failed:', data.msg);
			}
		},
		error: function(xhr, status, error) {
			console.error('Dashboard API error:', error);
		}
	});
}

function renderStats(stats) {
	if (!stats) return;

	$('#statNewCnslt').text(formatNumber(stats.newCnsltCnt || 0));
	$('#statCase').text(formatNumber(stats.caseCnt || 0));
	$('#statReview').text(formatNumber(stats.reviewCnt || 0));
	$('#statProduct').text(formatNumber(stats.productCnt || 0));
}

function renderActivities(activities) {
	var container = $('#activityList');
	container.empty();

	if (!activities || activities.length === 0) {
		container.html('<li class="activity-item"><div class="activity-content"><div class="activity-desc" style="color: var(--cv-silver-400);">최근 활동이 없습니다.</div></div></li>');
		return;
	}

	var icons = {
		'consultation': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',
		'review': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',
		'case': '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>'
	};

	$.each(activities, function(index, item) {
		var iconClass = item.icon || 'purple';
		var iconSvg = icons[item.type] || icons['consultation'];

		var html = '<li class="activity-item">';
		html += '<div class="activity-icon ' + iconClass + '">' + iconSvg + '</div>';
		html += '<div class="activity-content">';
		html += '<div class="activity-title">' + escapeHtml(item.title) + '</div>';
		html += '<div class="activity-desc">' + escapeHtml(item.desc) + '</div>';
		html += '</div>';
		html += '<div class="activity-time">' + escapeHtml(item.timeAgo) + '</div>';
		html += '</li>';

		container.append(html);
	});
}

function formatNumber(num) {
	if (!num) return '0';
	return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function escapeHtml(text) {
	if (!text) return '';
	var div = document.createElement('div');
	div.appendChild(document.createTextNode(text));
	return div.innerHTML;
}
</script>

</div>
</body>
</html>
