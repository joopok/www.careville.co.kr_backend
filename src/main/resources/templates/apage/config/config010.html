<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/apage/default_layout}">
<head>
  <title>환경 설정</title>
</head>
<body>
<div layout:fragment="content">

  <!-- Page Header -->
  <div class="cv-page-header">
    <div class="cv-page-header-left">
      <h1 class="cv-page-title">환경 설정</h1>
      <p class="cv-page-desc">사이트 기본 정보 및 운영 설정을 관리합니다</p>
    </div>
    <div class="cv-page-header-right">
      <button type="button" class="cv-btn cv-btn-outline" id="btnAddConfig">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        신규 등록
      </button>
      <button type="button" class="cv-btn cv-btn-primary" id="btnSaveAll">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        전체 저장
      </button>
    </div>
  </div>

  <!-- 설정 폼 -->
  <form id="configForm">

    <!-- 기본 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          <h3 class="cv-card-title">기본 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_BASIC">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- 연락처 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
          <h3 class="cv-card-title">연락처 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_CONTACT">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- 운영 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <h3 class="cv-card-title">운영 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_BUSINESS">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- SNS 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
          </svg>
          <h3 class="cv-card-title">SNS 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_SNS">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

  </form>

  <!-- 신규 등록 모달 -->
  <div class="cv-modal-overlay" id="addConfigModal" style="display: none;">
    <div class="cv-modal">
      <div class="cv-modal-header">
        <h3 class="cv-modal-title">새 설정 추가</h3>
        <button type="button" class="cv-modal-close" onclick="closeAddModal()">&times;</button>
      </div>
      <div class="cv-modal-body">
        <div class="cv-form-group">
          <label class="cv-form-label">설정 키 (영문 대문자)</label>
          <input type="text" class="cv-config-input" id="newConfigKey" placeholder="예: PHONE_DESCRIPTION" style="text-transform: uppercase;">
        </div>
        <div class="cv-form-group">
          <label class="cv-form-label">설명</label>
          <input type="text" class="cv-config-input" id="newConfigDesc" placeholder="예: 전화번호 설명">
        </div>
        <div class="cv-form-group">
          <label class="cv-form-label">그룹</label>
          <select class="cv-config-input" id="newConfigGroup">
            <option value="BASIC">기본 정보</option>
            <option value="CONTACT">연락처 정보</option>
            <option value="BUSINESS">운영 정보</option>
            <option value="SNS">SNS 정보</option>
          </select>
        </div>
        <div class="cv-form-group">
          <label class="cv-form-label">타입</label>
          <select class="cv-config-input" id="newConfigType">
            <option value="TEXT">TEXT (텍스트)</option>
            <option value="TEXTAREA">TEXTAREA (여러줄)</option>
            <option value="EMAIL">EMAIL (이메일)</option>
            <option value="TEL">TEL (전화번호)</option>
            <option value="URL">URL (링크)</option>
            <option value="NUMBER">NUMBER (숫자)</option>
          </select>
        </div>
        <div class="cv-form-group">
          <label class="cv-form-label">값</label>
          <input type="text" class="cv-config-input" id="newConfigValue" placeholder="설정 값 입력">
        </div>
        <div class="cv-form-group">
          <label class="cv-form-label">표시 순서</label>
          <input type="number" class="cv-config-input" id="newConfigOrder" value="999" placeholder="숫자가 작을수록 먼저 표시">
        </div>
      </div>
      <div class="cv-modal-footer">
        <button type="button" class="cv-btn cv-btn-outline" onclick="closeAddModal()">취소</button>
        <button type="button" class="cv-btn cv-btn-primary" onclick="submitAddConfig()">등록</button>
      </div>
    </div>
  </div>

  <!-- 히어로 섹션 배경 이미지 -->
  <div class="cv-data-card" style="margin-bottom: 20px;">
    <div class="cv-card-header">
      <div class="cv-card-header-left">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <circle cx="8.5" cy="8.5" r="1.5"></circle>
          <polyline points="21 15 16 10 5 21"></polyline>
        </svg>
        <h3 class="cv-card-title">히어로 섹션 배경 이미지</h3>
      </div>
      <div class="cv-card-header-right">
        <span class="cv-badge cv-badge-info">최대 10개 / 5MB 이하</span>
      </div>
    </div>
    <div class="cv-card-body">
      <p class="cv-hero-desc">랜딩 페이지 상단에 표시되는 배경 이미지입니다. 여러 장 등록 시 슬라이더로 표시됩니다.</p>
      <div class="cv-hero-grid" id="heroImageGrid">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>
  </div>

  <!-- 하단 고정 저장 버튼 -->
  <div class="cv-fixed-bottom">
    <button type="button" class="cv-btn cv-btn-primary cv-btn-lg" id="btnSaveAllBottom">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
      설정 저장
    </button>
  </div>

  <style>
    .cv-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-card-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .cv-card-title {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: var(--cv-silver-100, #e5e5e5);
    }
    .cv-card-body {
      padding: 20px;
    }
    .cv-loading {
      text-align: center;
      padding: 40px;
      color: var(--cv-silver-400, #666);
    }
    .cv-config-grid {
      display: grid;
      gap: 16px;
    }
    .cv-config-item {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 16px;
      align-items: start;
      padding: 12px 0;
      border-bottom: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-config-item:last-child {
      border-bottom: none;
    }
    .cv-config-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--cv-silver-200, #ccc);
      padding-top: 10px;
    }
    .cv-config-input {
      width: 100%;
      padding: 10px 14px;
      font-size: 14px;
      color: var(--cv-silver-100, #e5e5e5);
      background: var(--cv-graphite, #141414);
      border: 1px solid var(--cv-border-light, rgba(255,255,255,0.1));
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .cv-config-input:focus {
      outline: none;
      border-color: var(--cv-accent, #10b981);
      box-shadow: 0 0 0 3px var(--cv-accent-soft, rgba(16,185,129,0.08));
    }
    .cv-config-input::placeholder {
      color: var(--cv-silver-500, #444);
    }
    .cv-config-textarea {
      min-height: 100px;
      resize: vertical;
    }
    .cv-fixed-bottom {
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, var(--cv-obsidian, #0a0a0a) 80%, transparent);
      padding: 24px 0;
      text-align: center;
      margin-top: 20px;
    }
    .cv-btn-lg {
      padding: 14px 32px;
      font-size: 15px;
    }
    @media (max-width: 768px) {
      .cv-config-item {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .cv-config-label {
        padding-top: 0;
      }
    }

    /* 히어로 이미지 스타일 */
    .cv-hero-desc {
      color: var(--cv-silver-400, #888);
      font-size: 13px;
      margin-bottom: 20px;
    }
    .cv-hero-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }
    .cv-hero-item {
      position: relative;
      background: var(--cv-graphite, #141414);
      border: 2px dashed var(--cv-border-light, rgba(255,255,255,0.1));
      border-radius: 12px;
      aspect-ratio: 16/9;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      overflow: hidden;
    }
    .cv-hero-item:hover {
      border-color: var(--cv-accent, #10b981);
      background: var(--cv-charcoal, #1a1a1a);
    }
    .cv-hero-item.has-image {
      border-style: solid;
      border-color: var(--cv-accent, #10b981);
    }
    .cv-hero-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .cv-hero-item .cv-hero-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .cv-hero-item:hover .cv-hero-overlay {
      opacity: 1;
    }
    .cv-hero-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: var(--cv-silver-500, #555);
    }
    .cv-hero-placeholder svg {
      opacity: 0.5;
    }
    .cv-hero-placeholder span {
      font-size: 12px;
    }
    .cv-hero-number {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 4px;
    }
    .cv-hero-btn {
      padding: 8px 12px;
      font-size: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
    }
    .cv-hero-btn-upload {
      background: var(--cv-accent, #10b981);
      color: #fff;
    }
    .cv-hero-btn-upload:hover {
      background: var(--cv-accent-hover, #059669);
    }
    .cv-hero-btn-delete {
      background: var(--cv-error, #ef4444);
      color: #fff;
    }
    .cv-hero-btn-delete:hover {
      background: #dc2626;
    }
    .cv-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 500;
    }
    .cv-badge-info {
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
    }
    .cv-hero-file-input {
      display: none;
    }

    /* 모달 스타일 */
    .cv-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .cv-modal {
      background: var(--cv-charcoal, #1a1a1a);
      border-radius: 12px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    .cv-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-modal-title {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--cv-silver-100, #e5e5e5);
    }
    .cv-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--cv-silver-400, #888);
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }
    .cv-modal-close:hover {
      color: var(--cv-silver-100, #e5e5e5);
    }
    .cv-modal-body {
      padding: 24px;
    }
    .cv-modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-form-group {
      margin-bottom: 16px;
    }
    .cv-form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: var(--cv-silver-300, #aaa);
      margin-bottom: 8px;
    }
    .cv-btn-outline {
      background: transparent;
      border: 1px solid var(--cv-border-light, rgba(255,255,255,0.2));
      color: var(--cv-silver-200, #ccc);
    }
    .cv-btn-outline:hover {
      background: rgba(255,255,255,0.05);
      border-color: var(--cv-silver-400, #888);
    }

    /* 삭제 버튼 스타일 */
    .cv-config-item {
      position: relative;
    }
    .cv-config-delete {
      position: absolute;
      top: 12px;
      right: 0;
      background: none;
      border: none;
      color: var(--cv-silver-500, #555);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    .cv-config-delete:hover {
      color: var(--cv-error, #ef4444);
      background: rgba(239, 68, 68, 0.1);
    }
    .cv-config-input-wrap {
      padding-right: 40px;
    }
  </style>

  <script th:inline="javascript">
    // 개발 모드 체크 (localhost에서만 로그 출력)
    var isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    function devLog() {
      if (isDev && console && console.log) {
        console.log.apply(console, arguments);
      }
    }

    var configData = {};

    function loadConfigs() {
      $.ajax({
        url: '/configList.do',
        type: 'POST',
        data: {},
        dataType: 'json',
        success: function(rs) {
          configData = rs;
          renderGroup('BASIC', rs.BASIC);
          renderGroup('CONTACT', rs.CONTACT);
          renderGroup('BUSINESS', rs.BUSINESS);
          renderGroup('SNS', rs.SNS);
        },
        error: function() {
          swal('오류', '설정을 불러오는데 실패했습니다.', 'error');
        }
      });
    }

    function renderGroup(group, list) {
      var $container = $('#configGroup_' + group);
      $container.empty();

      if (!list || list.length === 0) {
        $container.html('<div class="cv-empty"><svg class="cv-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><p class="cv-empty-title">설정 항목이 없습니다</p></div>');
        return;
      }

      var html = '<div class="cv-config-grid">';
      list.forEach(function(item) {
        var inputType = item.configType || 'TEXT';
        var inputHtml = '';

        if (inputType === 'TEXTAREA') {
          inputHtml = '<textarea class="cv-config-input cv-config-textarea" ' +
                      'name="' + item.configKey + '" ' +
                      'data-key="' + item.configKey + '" ' +
                      'placeholder="' + (item.configDesc || '') + '">' +
                      (item.configValue || '') + '</textarea>';
        } else {
          var type = 'text';
          if (inputType === 'EMAIL') type = 'email';
          else if (inputType === 'TEL') type = 'tel';
          else if (inputType === 'URL') type = 'url';
          else if (inputType === 'NUMBER') type = 'number';

          inputHtml = '<input type="' + type + '" class="cv-config-input" ' +
                      'name="' + item.configKey + '" ' +
                      'data-key="' + item.configKey + '" ' +
                      'placeholder="' + (item.configDesc || '') + '" ' +
                      'value="' + (item.configValue || '') + '">';
        }

        html += '<div class="cv-config-item">' +
                '<div class="cv-config-label">' + item.configDesc + '<br><small style="color:#666;font-weight:normal;">' + item.configKey + '</small></div>' +
                '<div class="cv-config-input-wrap">' + inputHtml + '</div>' +
                '<button type="button" class="cv-config-delete" onclick="deleteConfig(\'' + item.configKey + '\', \'' + item.configDesc + '\')" title="삭제">' +
                '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>' +
                '</button>' +
                '</div>';
      });
      html += '</div>';
      $container.html(html);
    }

    function saveAll() {
      var configs = [];
      $('#configForm').find('.cv-config-input').each(function() {
        var $input = $(this);
        var key = $input.data('key');
        var value = $input.val();
        if (key) {
          configs.push({
            configKey: key,
            configValue: value
          });
        }
      });

      if (configs.length === 0) {
        swal('알림', '저장할 설정이 없습니다.', 'warning');
        return;
      }

      $.ajax({
        url: '/configSaveAll.do',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(configs),
        dataType: 'json',
        success: function(rs) {
          if (rs.success) {
            swal('완료', '설정이 저장되었습니다. (' + rs.updatedCount + '건)', 'success');
          } else {
            swal('실패', rs.message || '저장에 실패했습니다.', 'error');
          }
        },
        error: function() {
          swal('오류', '저장 중 오류가 발생했습니다.', 'error');
        }
      });
    }

    // ===================== 히어로 이미지 관리 =====================
    var heroImageKeys = [
      'HERO_IMG_01', 'HERO_IMG_02', 'HERO_IMG_03', 'HERO_IMG_04', 'HERO_IMG_05',
      'HERO_IMG_06', 'HERO_IMG_07', 'HERO_IMG_08', 'HERO_IMG_09', 'HERO_IMG_10'
    ];

    function loadHeroImages() {
      devLog('[loadHeroImages] 호출됨');
      $.ajax({
        url: '/configByGroup.do',
        type: 'POST',
        data: { configGroup: 'HERO' },
        dataType: 'json',
        success: function(rs) {
          devLog('[loadHeroImages] API 응답:', rs);
          // list 또는 data 키 모두 지원
          var list = rs.list || rs.data || rs.HERO || [];
          devLog('[loadHeroImages] list:', list);
          renderHeroImages(list);
        },
        error: function(xhr, status, error) {
          devLog('[loadHeroImages] 에러:', status, error);
          $('#heroImageGrid').html('<div class="cv-empty">히어로 이미지를 불러오는데 실패했습니다.</div>');
        }
      });
    }

    function renderHeroImages(list) {
      devLog('[renderHeroImages] list 개수:', list.length);
      var $grid = $('#heroImageGrid');
      $grid.empty();

      // HERO 그룹만 필터링
      var heroList = list.filter(function(item) {
        return item.configGroup === 'HERO' || item.configKey.startsWith('HERO_IMG_');
      });
      devLog('[renderHeroImages] heroList 개수:', heroList.length);

      // 이미지 데이터를 키로 매핑
      var imageMap = {};
      heroList.forEach(function(item) {
        devLog('[renderHeroImages] item:', item.configKey, '=', item.configValue);
        imageMap[item.configKey] = item.configValue;
      });

      // 10개 슬롯 렌더링
      heroImageKeys.forEach(function(key, index) {
        var value = imageMap[key] || '';
        var hasImage = value && value.trim() !== '';
        var num = index + 1;

        var html = '<div class="cv-hero-item' + (hasImage ? ' has-image' : '') + '" data-key="' + key + '">';
        html += '<span class="cv-hero-number">' + num + '</span>';

        if (hasImage) {
          html += '<img src="/fileDown.do?path=' + encodeURIComponent(value) + '" alt="히어로 이미지 ' + num + '">';
          html += '<div class="cv-hero-overlay">';
          html += '<button type="button" class="cv-hero-btn cv-hero-btn-upload" onclick="triggerUpload(\'' + key + '\')">';
          html += '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>';
          html += '변경</button>';
          html += '<button type="button" class="cv-hero-btn cv-hero-btn-delete" onclick="deleteHeroImage(\'' + key + '\')">';
          html += '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>';
          html += '삭제</button>';
          html += '</div>';
        } else {
          html += '<div class="cv-hero-placeholder" onclick="triggerUpload(\'' + key + '\')">';
          html += '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">';
          html += '<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>';
          html += '<circle cx="8.5" cy="8.5" r="1.5"></circle>';
          html += '<polyline points="21 15 16 10 5 21"></polyline>';
          html += '</svg>';
          html += '<span>이미지 업로드</span>';
          html += '</div>';
        }

        html += '<input type="file" class="cv-hero-file-input" id="heroFile_' + key + '" accept="image/*" onchange="uploadHeroImage(\'' + key + '\', this)">';
        html += '</div>';

        $grid.append(html);
      });
    }

    function triggerUpload(configKey) {
      $('#heroFile_' + configKey).click();
    }

    function uploadHeroImage(configKey, input) {
      if (!input.files || !input.files[0]) return;

      var file = input.files[0];

      // 파일 크기 체크 (5MB)
      if (file.size > 5 * 1024 * 1024) {
        swal('오류', '파일 크기는 5MB 이하만 가능합니다.', 'error');
        input.value = '';
        return;
      }

      // 이미지 파일 체크
      if (!file.type.startsWith('image/')) {
        swal('오류', '이미지 파일만 업로드 가능합니다.', 'error');
        input.value = '';
        return;
      }

      var formData = new FormData();
      formData.append('file', file);
      formData.append('configKey', configKey);

      // 업로드 중 표시
      var $item = $('.cv-hero-item[data-key="' + configKey + '"]');
      $item.addClass('uploading');
      $item.find('.cv-hero-placeholder, .cv-hero-overlay').html('<div style="color:#10b981;">업로드 중...</div>');

      $.ajax({
        url: '/heroImageUpload.do',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        dataType: 'json',
        success: function(rs) {
          devLog('[uploadHeroImage] 응답:', rs);
          if (rs.success) {
            swal({
              title: '완료',
              text: '이미지가 업로드되었습니다.',
              type: 'success'
            }, function() {
              loadHeroImages();
            });
          } else {
            swal({
              title: '실패',
              text: rs.message || '업로드에 실패했습니다.',
              type: 'error'
            }, function() {
              loadHeroImages();
            });
          }
        },
        error: function(xhr, status, error) {
          devLog('[uploadHeroImage] 에러:', status, error);
          swal({
            title: '오류',
            text: '업로드 중 오류가 발생했습니다.',
            type: 'error'
          }, function() {
            loadHeroImages();
          });
        },
        complete: function() {
          input.value = '';
        }
      });
    }

    function deleteHeroImage(configKey) {
      swal({
        title: '이미지 삭제',
        text: '이 히어로 이미지를 삭제하시겠습니까?',
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        confirmButtonText: '삭제',
        cancelButtonText: '취소'
      }, function(isConfirm) {
        if (isConfirm) {
          $.ajax({
            url: '/heroImageDelete.do',
            type: 'POST',
            data: { configKey: configKey },
            dataType: 'json',
            success: function(rs) {
              if (rs.success) {
                swal('완료', '이미지가 삭제되었습니다.', 'success');
                loadHeroImages();
              } else {
                swal('실패', rs.message || '삭제에 실패했습니다.', 'error');
              }
            },
            error: function() {
              swal('오류', '삭제 중 오류가 발생했습니다.', 'error');
            }
          });
        }
      });
    }

    // ===================== 신규 등록 =====================
    function openAddModal() {
      $('#newConfigKey').val('');
      $('#newConfigDesc').val('');
      $('#newConfigValue').val('');
      $('#newConfigGroup').val('BASIC');
      $('#newConfigType').val('TEXT');
      $('#newConfigOrder').val('999');
      $('#addConfigModal').fadeIn(200);
    }

    function closeAddModal() {
      $('#addConfigModal').fadeOut(200);
    }

    function submitAddConfig() {
      var configKey = $('#newConfigKey').val().trim().toUpperCase();
      var configDesc = $('#newConfigDesc').val().trim();
      var configValue = $('#newConfigValue').val();
      var configGroup = $('#newConfigGroup').val();
      var configType = $('#newConfigType').val();
      var displayOrder = $('#newConfigOrder').val() || '999';

      if (!configKey) {
        swal('알림', '설정 키를 입력하세요.', 'warning');
        return;
      }
      if (!configDesc) {
        swal('알림', '설명을 입력하세요.', 'warning');
        return;
      }
      if (!/^[A-Z0-9_]+$/.test(configKey)) {
        swal('알림', '설정 키는 영문 대문자, 숫자, 언더스코어(_)만 사용 가능합니다.', 'warning');
        return;
      }

      $.ajax({
        url: '/configReg.do',
        type: 'POST',
        data: {
          configKey: configKey,
          configValue: configValue,
          configDesc: configDesc,
          configGroup: configGroup,
          configType: configType,
          displayOrder: displayOrder
        },
        dataType: 'json',
        success: function(rs) {
          if (rs.isReg === 'Y') {
            swal('완료', '설정이 등록되었습니다.', 'success');
            closeAddModal();
            loadConfigs();
          } else {
            swal('실패', rs.message || '이미 존재하는 키이거나 등록에 실패했습니다.', 'error');
          }
        },
        error: function() {
          swal('오류', '등록 중 오류가 발생했습니다.', 'error');
        }
      });
    }

    // ===================== 삭제 =====================
    function deleteConfig(configKey, configDesc) {
      swal({
        title: '설정 삭제',
        text: '"' + configDesc + '" (' + configKey + ') 설정을 삭제하시겠습니까?\n\n삭제된 설정은 복구할 수 없습니다.',
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        confirmButtonText: '삭제',
        cancelButtonText: '취소'
      }, function(isConfirm) {
        if (isConfirm) {
          $.ajax({
            url: '/configDel.do',
            type: 'POST',
            data: { configKey: configKey },
            dataType: 'json',
            success: function(rs) {
              if (rs.isDel === 'Y') {
                swal('완료', '설정이 삭제되었습니다.', 'success');
                loadConfigs();
              } else {
                swal('실패', rs.message || '삭제에 실패했습니다.', 'error');
              }
            },
            error: function() {
              swal('오류', '삭제 중 오류가 발생했습니다.', 'error');
            }
          });
        }
      });
    }

    $(function() {
      loadConfigs();
      loadHeroImages();

      $('#btnSaveAll, #btnSaveAllBottom').on('click', function() {
        saveAll();
      });

      $('#btnAddConfig').on('click', function() {
        openAddModal();
      });

      // ESC 키로 모달 닫기
      $(document).on('keydown', function(e) {
        if (e.key === 'Escape') {
          closeAddModal();
        }
      });

      // 모달 외부 클릭 시 닫기
      $('#addConfigModal').on('click', function(e) {
        if (e.target === this) {
          closeAddModal();
        }
      });
    });
  </script>
</div>
</body>
</html>
