<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/apage/default_layout}">
<head>
  <title>환경 설정</title>
</head>
<body>
<div layout:fragment="content">

  <!-- Page Header -->
  <div class="cv-page-header">
    <div class="cv-page-header-left">
      <h1 class="cv-page-title">환경 설정</h1>
      <p class="cv-page-desc">사이트 기본 정보 및 운영 설정을 관리합니다</p>
    </div>
    <div class="cv-page-header-right">
      <button type="button" class="cv-btn cv-btn-primary" id="btnSaveAll">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        전체 저장
      </button>
    </div>
  </div>

  <!-- 설정 폼 -->
  <form id="configForm">

    <!-- 기본 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          <h3 class="cv-card-title">기본 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_BASIC">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- 연락처 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
          </svg>
          <h3 class="cv-card-title">연락처 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_CONTACT">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- 운영 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <h3 class="cv-card-title">운영 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_BUSINESS">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

    <!-- SNS 정보 -->
    <div class="cv-data-card" style="margin-bottom: 20px;">
      <div class="cv-card-header">
        <div class="cv-card-header-left">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="opacity: 0.7;">
            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
          </svg>
          <h3 class="cv-card-title">SNS 정보</h3>
        </div>
      </div>
      <div class="cv-card-body" id="configGroup_SNS">
        <div class="cv-loading">로딩 중...</div>
      </div>
    </div>

  </form>

  <!-- 하단 고정 저장 버튼 -->
  <div class="cv-fixed-bottom">
    <button type="button" class="cv-btn cv-btn-primary cv-btn-lg" id="btnSaveAllBottom">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
      설정 저장
    </button>
  </div>

  <style>
    .cv-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-card-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .cv-card-title {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: var(--cv-silver-100, #e5e5e5);
    }
    .cv-card-body {
      padding: 20px;
    }
    .cv-loading {
      text-align: center;
      padding: 40px;
      color: var(--cv-silver-400, #666);
    }
    .cv-config-grid {
      display: grid;
      gap: 16px;
    }
    .cv-config-item {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 16px;
      align-items: start;
      padding: 12px 0;
      border-bottom: 1px solid var(--cv-border, rgba(255,255,255,0.06));
    }
    .cv-config-item:last-child {
      border-bottom: none;
    }
    .cv-config-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--cv-silver-200, #ccc);
      padding-top: 10px;
    }
    .cv-config-input {
      width: 100%;
      padding: 10px 14px;
      font-size: 14px;
      color: var(--cv-silver-100, #e5e5e5);
      background: var(--cv-graphite, #141414);
      border: 1px solid var(--cv-border-light, rgba(255,255,255,0.1));
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .cv-config-input:focus {
      outline: none;
      border-color: var(--cv-accent, #10b981);
      box-shadow: 0 0 0 3px var(--cv-accent-soft, rgba(16,185,129,0.08));
    }
    .cv-config-input::placeholder {
      color: var(--cv-silver-500, #444);
    }
    .cv-config-textarea {
      min-height: 100px;
      resize: vertical;
    }
    .cv-fixed-bottom {
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, var(--cv-obsidian, #0a0a0a) 80%, transparent);
      padding: 24px 0;
      text-align: center;
      margin-top: 20px;
    }
    .cv-btn-lg {
      padding: 14px 32px;
      font-size: 15px;
    }
    @media (max-width: 768px) {
      .cv-config-item {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .cv-config-label {
        padding-top: 0;
      }
    }
  </style>

  <script th:inline="javascript">
    var configData = {};

    function loadConfigs() {
      $.ajax({
        url: '/configList.do',
        type: 'POST',
        data: {},
        dataType: 'json',
        success: function(rs) {
          configData = rs;
          renderGroup('BASIC', rs.BASIC);
          renderGroup('CONTACT', rs.CONTACT);
          renderGroup('BUSINESS', rs.BUSINESS);
          renderGroup('SNS', rs.SNS);
        },
        error: function() {
          swal('오류', '설정을 불러오는데 실패했습니다.', 'error');
        }
      });
    }

    function renderGroup(group, list) {
      var $container = $('#configGroup_' + group);
      $container.empty();

      if (!list || list.length === 0) {
        $container.html('<div class="cv-empty"><svg class="cv-empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><p class="cv-empty-title">설정 항목이 없습니다</p></div>');
        return;
      }

      var html = '<div class="cv-config-grid">';
      list.forEach(function(item) {
        var inputType = item.configType || 'TEXT';
        var inputHtml = '';

        if (inputType === 'TEXTAREA') {
          inputHtml = '<textarea class="cv-config-input cv-config-textarea" ' +
                      'name="' + item.configKey + '" ' +
                      'data-key="' + item.configKey + '" ' +
                      'placeholder="' + (item.configDesc || '') + '">' +
                      (item.configValue || '') + '</textarea>';
        } else {
          var type = 'text';
          if (inputType === 'EMAIL') type = 'email';
          else if (inputType === 'TEL') type = 'tel';
          else if (inputType === 'URL') type = 'url';
          else if (inputType === 'NUMBER') type = 'number';

          inputHtml = '<input type="' + type + '" class="cv-config-input" ' +
                      'name="' + item.configKey + '" ' +
                      'data-key="' + item.configKey + '" ' +
                      'placeholder="' + (item.configDesc || '') + '" ' +
                      'value="' + (item.configValue || '') + '">';
        }

        html += '<div class="cv-config-item">' +
                '<div class="cv-config-label">' + item.configDesc + '</div>' +
                '<div class="cv-config-input-wrap">' + inputHtml + '</div>' +
                '</div>';
      });
      html += '</div>';
      $container.html(html);
    }

    function saveAll() {
      var configs = [];
      $('#configForm').find('.cv-config-input').each(function() {
        var $input = $(this);
        var key = $input.data('key');
        var value = $input.val();
        if (key) {
          configs.push({
            configKey: key,
            configValue: value
          });
        }
      });

      if (configs.length === 0) {
        swal('알림', '저장할 설정이 없습니다.', 'warning');
        return;
      }

      $.ajax({
        url: '/configSaveAll.do',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(configs),
        dataType: 'json',
        success: function(rs) {
          if (rs.success) {
            swal('완료', '설정이 저장되었습니다. (' + rs.updatedCount + '건)', 'success');
          } else {
            swal('실패', rs.message || '저장에 실패했습니다.', 'error');
          }
        },
        error: function() {
          swal('오류', '저장 중 오류가 발생했습니다.', 'error');
        }
      });
    }

    $(function() {
      loadConfigs();

      $('#btnSaveAll, #btnSaveAllBottom').on('click', function() {
        saveAll();
      });
    });
  </script>
</div>
</body>
</html>
