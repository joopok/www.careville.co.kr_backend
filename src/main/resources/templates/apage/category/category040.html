<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/apage/default_layout}">
<head>
<title>카테고리 수정</title>
<!-- All styles now in careville-admin.css -->
</head>
<body>
<div layout:fragment="content">

	<!-- Page Header -->
	<div class="cv-page-header">
		<div class="cv-page-header-left">
			<h1 class="cv-page-title">카테고리 수정</h1>
			<p class="cv-page-desc">서비스 카테고리 정보를 수정합니다</p>
		</div>
		<div class="cv-page-header-right">
			<button type="button" class="cv-btn cv-btn-secondary" onclick="location.href='/apage/category010.do'">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="8" y1="6" x2="21" y2="6"></line>
					<line x1="8" y1="12" x2="21" y2="12"></line>
					<line x1="8" y1="18" x2="21" y2="18"></line>
					<line x1="3" y1="6" x2="3.01" y2="6"></line>
					<line x1="3" y1="12" x2="3.01" y2="12"></line>
					<line x1="3" y1="18" x2="3.01" y2="18"></line>
				</svg>
				목록
			</button>
		</div>
	</div>

	<!-- Form Card -->
	<div class="cv-card">
		<div class="cv-card-body">
			<form id="serviceForm" method="post" action="#">
				<input type="hidden" id="serviceCd" name="serviceCd" th:value="${detail.serviceCd}">

				<!-- 서비스 코드, 서비스명 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">서비스 코드</div>
						<div class="cv-detail-value">
							<code th:text="${detail.serviceCd}"></code>
						</div>
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">서비스명 <span class="required">*</span></div>
						<input type="text" class="cv-form-input" id="serviceNm" name="serviceNm"
							   th:value="${detail.serviceNm}" maxlength="100" required>
					</div>
				</div>

				<!-- 정렬 순서, 사용 여부 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">정렬 순서</div>
						<input type="number" class="cv-form-input w-auto" id="serviceOrder" name="serviceOrder"
							   th:value="${detail.serviceOrder}" min="1">
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">사용 여부</div>
						<div class="cv-radio-group">
							<div class="cv-radio-item">
								<input type="radio" name="useYn" id="useY" value="Y"
									   th:checked="${detail.useYn == 'Y'}">
								<label for="useY">사용</label>
							</div>
							<div class="cv-radio-item">
								<input type="radio" name="useYn" id="useN" value="N"
									   th:checked="${detail.useYn == 'N'}">
								<label for="useN">미사용</label>
							</div>
						</div>
					</div>
				</div>

				<!-- 등록일시, 수정일시 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">등록일시</div>
						<div class="cv-detail-value" th:text="${detail.regDt} ?: '-'"></div>
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">수정일시</div>
						<div class="cv-detail-value" th:text="${detail.modDt} ?: '-'"></div>
					</div>
				</div>

				<!-- 버튼 -->
				<div class="cv-btn-group">
					<button type="button" class="cv-btn cv-btn-primary" onclick="updateServiceCategory()">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
							<polyline points="17 21 17 13 7 13 7 21"></polyline>
							<polyline points="7 3 7 8 15 8"></polyline>
						</svg>
						수정
					</button>
					<button type="button" class="cv-btn cv-btn-danger" onclick="deleteServiceCategory()">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="3 6 5 6 21 6"></polyline>
							<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
						</svg>
						삭제
					</button>
					<button type="button" class="cv-btn cv-btn-secondary"
							th:attr="data-servicecd=${detail.serviceCd}"
							onclick="location.href='/apage/category020.do?serviceCd=' + this.dataset.servicecd">
						취소
					</button>
				</div>

			</form>
		</div>
	</div>

	<script th:inline="javascript">
		var serviceCd = /*[[${detail.serviceCd}]]*/ '';

		function updateServiceCategory() {
			var serviceNm = $('#serviceNm').val().trim();

			if (!serviceNm) {
				swal({title: '서비스명을 입력하세요.', type: 'warning'});
				$('#serviceNm').focus();
				return;
			}

			$.ajax({
				url: '/apage/category041.do',
				type: 'POST',
				data: $('#serviceForm').serialize(),
				dataType: 'json',
				success: function(data) {
					if (data.result && data.result.result === 'SUCCESS') {
						swal({title: data.result.msg, type: 'success'}, function() {
							location.href = '/apage/category020.do?serviceCd=' + serviceCd;
						});
					} else {
						swal({title: data.result.msg || '수정에 실패하였습니다.', type: 'error'});
					}
				},
				error: function() {
					swal({title: '서버 오류가 발생하였습니다.', type: 'error'});
				}
			});
		}

		function deleteServiceCategory() {
			swal({
				title: '정말로 삭제하시겠습니까?',
				text: '삭제된 데이터는 복구할 수 없습니다.',
				type: 'warning',
				showCancelButton: true,
				confirmButtonText: '삭제',
				cancelButtonText: '취소',
				closeOnConfirm: false
			}, function(isConfirm) {
				if (!isConfirm) return;

				$.ajax({
					url: '/apage/category051.do',
					type: 'POST',
					data: { serviceCd: serviceCd },
					dataType: 'json',
					success: function(data) {
						if (data && data.result === 'SUCCESS') {
							swal({title: data.msg, type: 'success'}, function() {
								location.href = '/apage/category010.do';
							});
						} else {
							swal({title: data.msg || '삭제에 실패하였습니다.', type: 'error'});
						}
					},
					error: function() {
						swal({title: '서버 오류가 발생하였습니다.', type: 'error'});
					}
				});
			});
		}
	</script>

</div>
</body>
</html>
