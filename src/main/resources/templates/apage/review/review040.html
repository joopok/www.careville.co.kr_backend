<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/apage/default_layout}">
<head>
<title>고객리뷰 수정</title>
<!-- All styles now in careville-admin.css -->
<script th:src="@{/apage/js/review040.js}"></script>
<script th:src="@{/plugins/jquery-inputmask/jquery.inputmask.bundle.js}"></script>
</head>
<body>
<div layout:fragment="content">

	<form id="searchMap" method="POST">
		<th:block th:each="entry : ${searchMap}">
			<input type="hidden" th:name="${entry.key}" th:value="${entry.value != null ? entry.value : ''}">
		</th:block>
	</form>

	<!-- Page Header -->
	<div class="cv-page-header">
		<div class="cv-page-header-left">
			<h1 class="cv-page-title">고객리뷰 수정</h1>
			<p class="cv-page-desc">고객 리뷰 정보를 수정합니다</p>
		</div>
		<div class="cv-page-header-right">
			<button type="button" class="cv-btn cv-btn-secondary" id="btnList">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="8" y1="6" x2="21" y2="6"></line>
					<line x1="8" y1="12" x2="21" y2="12"></line>
					<line x1="8" y1="18" x2="21" y2="18"></line>
					<line x1="3" y1="6" x2="3.01" y2="6"></line>
					<line x1="3" y1="12" x2="3.01" y2="12"></line>
					<line x1="3" y1="18" x2="3.01" y2="18"></line>
				</svg>
				목록
			</button>
		</div>
	</div>

	<!-- Form Card -->
	<div class="cv-card">
		<div class="cv-card-body">
			<form id="reviewForm">
				<input type="hidden" id="reviewSeq" name="reviewSeq" th:value="${view.reviewSeq}">

				<!-- 작성자명, 서비스 종류 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">작성자명 <span class="required">*</span></div>
						<input type="text" class="cv-form-input" id="reviewNm" name="reviewNm"
							   th:value="${view.reviewNm}" required>
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">서비스 종류 <span class="required">*</span></div>
						<select id="serviceCd" name="serviceCd" class="cv-form-select" required>
							<option value="">선택하세요</option>
							<option th:each="code : ${serviceCdLst}"
									th:value="${code.serviceCd}"
									th:text="${code.serviceNm}"
									th:selected="${code.serviceCd == view.serviceCd}"></option>
						</select>
					</div>
				</div>

				<!-- 별점, 서비스 날짜, 노출 여부 -->
				<div class="cv-detail-grid cols-3">
					<div class="cv-detail-item">
						<div class="cv-detail-label">별점 <span class="required">*</span></div>
						<div class="cv-star-rating" id="starRating">
							<svg class="star" data-value="1" viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
							</svg>
							<svg class="star" data-value="2" viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
							</svg>
							<svg class="star" data-value="3" viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
							</svg>
							<svg class="star" data-value="4" viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
							</svg>
							<svg class="star" data-value="5" viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
							</svg>
						</div>
						<input type="hidden" id="starRate" name="starRate" th:value="${view.starRate}">
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">서비스 받은 날짜</div>
						<input type="text" class="cv-form-input" id="svcDate" name="svcDate"
							   th:value="${view.svcDate}" placeholder="20250101">
					</div>
					<div class="cv-detail-item">
						<div class="cv-detail-label">노출 여부</div>
						<div class="cv-toggle-wrap">
							<span class="cv-toggle-label" th:classappend="${view.dispYn != 'Y'} ? ' active' : ''">비노출</span>
							<div class="cv-toggle" id="dispToggle" th:classappend="${view.dispYn == 'Y'} ? ' active' : ''"></div>
							<span class="cv-toggle-label" th:classappend="${view.dispYn == 'Y'} ? ' active' : ''">노출</span>
							<input type="hidden" id="dispYn" name="dispYn" th:value="${view.dispYn}">
						</div>
					</div>
				</div>

				<!-- 후기 내용 -->
				<div class="cv-detail-grid cols-1">
					<div class="cv-detail-item">
						<div class="cv-detail-label">후기 내용 <span class="required">*</span></div>
						<textarea id="reviewCn" name="reviewCn" class="cv-form-textarea" required
								  th:text="${view.reviewCn}"></textarea>
					</div>
				</div>

				<!-- 등록일시 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">등록일시</div>
						<div class="cv-detail-value" th:text="${view.rgsDt} ?: '-'"></div>
					</div>
				</div>

				<!-- 비밀번호 -->
				<div class="cv-detail-grid">
					<div class="cv-detail-item">
						<div class="cv-detail-label">비밀번호 확인</div>
						<input type="password" class="cv-form-input" id="pw" name="pw"
							   placeholder="수정 권한 확인을 위한 비밀번호">
						<div class="cv-form-hint">작성시 입력한 비밀번호를 입력하세요. (관리자는 입력 불필요)</div>
					</div>
				</div>

				<!-- 버튼 -->
				<div class="cv-btn-group">
					<button type="button" class="cv-btn cv-btn-primary" onclick="updateReview()">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
							<polyline points="17 21 17 13 7 13 7 21"></polyline>
							<polyline points="7 3 7 8 15 8"></polyline>
						</svg>
						수정
					</button>
					<button type="button" class="cv-btn cv-btn-danger" onclick="deleteReview()">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="3 6 5 6 21 6"></polyline>
							<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
						</svg>
						삭제
					</button>
					<button type="button" class="cv-btn cv-btn-secondary" id="btnListBottom">
						목록으로
					</button>
				</div>

			</form>
		</div>
	</div>

	<script th:inline="javascript">
		var reviewSeq = /*[[${view.reviewSeq}]]*/ '';
		var initialStarRate = /*[[${view.starRate}]]*/ 5;

		$(document).ready(function() {
			// Initialize star rating
			$('#starRating .star').each(function(index) {
				if (index < initialStarRate) {
					$(this).addClass('active');
				}
			});

			// Star Rating Handler
			$('#starRating .star').on('click', function() {
				var value = $(this).data('value');
				$('#starRate').val(value);

				$('#starRating .star').each(function(index) {
					if (index < value) {
						$(this).addClass('active');
					} else {
						$(this).removeClass('active');
					}
				});
			});

			// Toggle Handler
			$('#dispToggle').on('click', function() {
				$(this).toggleClass('active');
				var isActive = $(this).hasClass('active');
				$('#dispYn').val(isActive ? 'Y' : 'N');

				// Update labels
				$(this).prev('.cv-toggle-label').toggleClass('active', !isActive);
				$(this).next('.cv-toggle-label').toggleClass('active', isActive);
			});

			// Date mask
			if ($.fn.inputmask) {
				$('#svcDate').inputmask('99999999', {placeholder: ''});
			}

			// List buttons
			$('#btnList, #btnListBottom').on('click', function() {
				cancelList();
			});
		});

		function deleteReview() {
			swal({
				title: '정말로 삭제하시겠습니까?',
				text: '삭제된 데이터는 복구할 수 없습니다.',
				type: 'warning',
				showCancelButton: true,
				confirmButtonText: '삭제',
				cancelButtonText: '취소',
				closeOnConfirm: false
			}, function(isConfirm) {
				if (!isConfirm) return;

				$.ajax({
					url: '/apage/review051.do',
					type: 'POST',
					data: { reviewSeq: reviewSeq },
					dataType: 'json',
					success: function(data) {
						if (data && data.result === 'SUCCESS') {
							swal({title: data.msg, type: 'success'}, function() {
								location.href = '/apage/review010.do';
							});
						} else {
							swal({title: data.msg || '삭제에 실패하였습니다.', type: 'error'});
						}
					},
					error: function() {
						swal({title: '서버 오류가 발생하였습니다.', type: 'error'});
					}
				});
			});
		}
	</script>

</div>
</body>
</html>
